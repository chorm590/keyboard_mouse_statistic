KMS键鼠统计软件设计手册



# A. UI

KMS为基于.NET CORE的Windows桌面程序。

KMS共有三个级联的软件界面。

第一级为程序主界面，承载键鼠事件概览信息。此级共有三个数据展示区域：1、全局键盘事件统计；2、全局鼠标事件统计；3、今日事件统计。在“今日事件统计”区域中可以触发第二级界面。

第二级程序界面为键鼠事件分段统计展示区。此级界面可以选择时间展示指定日期的事件统计。此级展示的数据共有四种细粒度：1、时；2、天；3、月；4、年。每种细粒度下共展示两种统计信息：1、键盘总数量；2、鼠标总数量。通过点击每种细粒度下信息可触发第三级程序界面的展示。

第三级程序界面为指定细粒度下的详细信息展示。如每个按键在当前统计条件下的事件总量。



另，在第一级程序界面的区域1下可以触发一个额外的“第三级程序界面”展示框，用于展示完整且详细的事件统计。





# B. 数据处理

数据记录方案：

按统计细粒度分别创建数据表，直接将事件录入为统计数据而不记录详细事件数据。



数据库设计：

软件采用 SQLite 数据库存储事件数据。

在软件根目录下创建 data 目录，其下按年份创建数据库文件。示例如下：

```
数据库文件相对路径：./data/
数据库文件名称：kms年.db
示例：./data/kms2021.db
```



每个数据库中的表类型如下所示：

```
1. summary
2. m1
3. d1
4. d1_detail
```

```
summary表，本年度数据。

表结构：
	year	SMALLINT
	type	SMALLINT
	value	INTEGER

表结构释义：
	year
		年
	type
		统计类型，详见下方类型表。
	value
		具体数据值。
```

```
m1表，1月份统计数据表。

表结构：
	year	SMALLINT
	month	TINYINT
	type	SMALLINT
	value	INTEGER

表结构释义：
	略
```

```
d1表，1号统计数据表。

表结构：
	year	SMALLINT
	month	TINYINT
	day		TINYINT
	type	SMALLINT
	value	INTEGER

表结构释义：
	略
```

```
d1_detail表，1号各小时段的统计数据表。

表结构：
	year	SMALLINT
	month	TINYINT
	day		TINYINT
	hour	TINYINT
	type	SMALLINT
	value	INTEGER

表结构释义：
	略
```






```
type类型值定义：

0		无效值
1 ~ 0xff 键盘按键值

0x100	键盘总量
0x101	组合键总量
0x102	鼠标总量

0x200	鼠标左键【包括存储屏幕区域号】
0x201	鼠标右键【包括存储屏幕区域号】
0x202	滚轮前向滑动
0x203	滚轮后向滑动
0x204	滚轮点击
0x205	鼠标前侧键
0x206	鼠标后侧键

0x300	键盘单键总量第一
0x301	键盘单键总量第二
0x302	键盘单键总量第三
0x303	键盘单键总量第四
0x304	键盘单键总量第五
0x305	键盘组合键总量第一
0x306	键盘组合键总量第二
0x307	键盘组合键总量第三
0x308	鼠标左键区域第一
0x309	鼠标左键区域第二
0x30a	鼠标左键区域第三
0x30b	鼠标左键区域第四
0x30c	鼠标左键区域第五

0x400	操作最多的时段【小时统计】
```

```
屏幕区域号：

将显示屏水平与垂直各等分为十块。因此整个屏幕将被划分为100个区域，这些区域按自左上角水平向右至右下角的顺序编号，此即为区域编号。范围值为 1 ~ 100。
```





# C. 程序逻辑

1. 日志模块

2. 时间管理模块

3. 数据库认证管理

   数据库与机器认证绑定或通过用户绑定。

4. 库表设计

5. 数据处理

6. 统计管理

7. 键鼠事件监听

   全局事件

   键盘：

     1、所有按键事件

   鼠标：

     1、鼠标移动的距离；

     2、左右按键的点击次数；

     3、滚轮的滚动格数；

     4、滚轮的点击次数。

8. 工具栏图标

9. ~~文件管理~~

10. 配置管理

    XML管理

