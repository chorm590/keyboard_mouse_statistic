# A. 数据库

internal class DBManager 

​	顶级类。C部应从这里取得具体的数据

internal class SQLiteManager

​	SQLite的管理类。负责管理实现CURD的实例以及数据库的分文件管理。

internal class SQLiteHelper

​	SQLite的CURD实现类。

internal class SQLiteMemoryDB

​	内存数据库实例。可通过配置开关是否在内存中暂存数据。

internal class SQLiteDB

​	将数据存入SQL数据库中的实现。





需要统计的维度：

1. 键盘总敲击量；
2. 键盘各单键的敲击总量；
3. 键盘组合键敲击总量；
4. 鼠标各单键敲击总量；
5. 每日统计中按小时统计各时段的键鼠操作总量；
6. 每日统计中按小时统计各时段敲击前三的按键/组合键；
7. 每日统计中按小时统计各时段鼠标点击区域热力；
8. 每月统计按日统计各时段键鼠操作总量；
9. 每月统计按日统计各时段敲击前三按键/组合键；
10. 每月统计按日统计各时段鼠标点击区域热力；
11. 每年统计，待定。



数据库设计：

软件采用 SQLite 数据库存储事件数据。

在软件根目录下创建 db 目录，目录内按年月组合创建数据库文件。

每个数据库中有如下两张表：

	1. summary
 	2. detail



具体的定义如下：

```
数据库文件相对路径：./db/
数据库文件名称：kms年月.db
示例：./db/kms202101.db
```

```
summary表，年度统计表，记录本年月度键鼠按键总数量。

表结构：
	_id SMALLINT PK
	type SMALLINT
	value MEDIUMINT
	
表结构释义：
	_id
		自增主键，2个字节，远远足够了。
	type
		统计类型，具体编号见下方定义。
	value
		具体的数值。如某个按键在本年度被按下的次数。数值上限被限定为20亿次，超过的将被忽略。
```

```
detail表，详细统计记录表。

表结构：
	_id MEDIUMINT PK
	year SMALLINT
	month TINYINT
	day TINIINT
	hour TINYINT
	minute TINYINT
	second TINYINT
	type SMALLINT
	value MEDIUMINT

表结构释义：
	year
	month
	day
	hour
	minute
	second
		具体日期。
	type
		统计类型，具体编号见下方定义。
	value
		具体事件的数值。
```



```
type类型值定义：

0 ~ 255 键盘按键值

```













# B. UI

只用一个界面完成所有展示。

左上角展示总览信息，右上角展示所有按键数据的条形图。下方展示多样化统计信息，包括条形图，折线图。

通过Binding连接及更新数据。





# C. 程序逻辑

1. 日志模块

2. 时间管理模块

3. 数据库认证管理

   数据库与机器认证绑定或通过用户绑定。

4. 库表设计

5. 数据处理

6. 统计管理

7. 键鼠事件监听

   全局事件

   键盘：

     1、所有按键事件

   鼠标：

     1、鼠标移动的距离；

     2、左右按键的点击次数；

     3、滚轮的滚动格数；

     4、滚轮的点击次数。

8. 工具栏图标

9. ~~文件管理~~

10. 配置管理

    XML管理

