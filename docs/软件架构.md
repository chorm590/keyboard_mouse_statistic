# A. 数据库



internal class DBManager 

​	顶级类。C部应从这里取得具体的数据

internal class SQLiteManager

​	SQLite的管理类。负责管理实现CURD的实例以及数据库的分文件管理。

internal class SQLiteMemoryDB

​	内存数据库实例。可通过配置开关是否在内存中暂存数据。

internal class SQLiteHelper

​	SQLite的CURD实现类。



数据记录方案：

按自然月分库记录详细键鼠事件。提供手动/自动根据既往数据生成的统计数据。



需要统计的维度：

1. 键盘总敲击量；
2. 键盘各单键的敲击总量；
3. 键盘组合键敲击总量；
4. 鼠标各单键敲击总量；
5. 每日统计中按小时统计各时段的键鼠操作总量；
6. 每日统计中按小时统计各时段敲击前三的按键/组合键；
7. 每日统计中按小时统计各时段鼠标点击区域热力；
8. 每月统计按日统计各时段键鼠操作总量；
9. 每月统计按日统计各时段敲击前三按键/组合键；
10. 每月统计按日统计各时段鼠标点击区域热力；
11. 每年统计，待定。



数据库设计：

软件采用 SQLite 数据库存储事件数据。

在软件根目录下创建 db 目录，其下按年份创建子目录，年份子目录内按年月组合创建数据库文件。

```
数据库文件相对路径：./db/2021/
数据库文件名称：kms年月.db
示例：./db/2021/kms202101.db
```



每个数据库中有如下三种表：

	1. summary
	2. day*_detail
	3. day*_summary



```
summary表，月度统计表。

表结构：
	_id SMALLINT PK
	day TINYINT
	type SMALLINT
	value MEDIUMINT
	
表结构释义：
	_id
		自增主键，2个字节，远远足够了。
	day
		天号，范围 1 ~ 31。
	type
		统计类型，具体编号见下方定义。
	value
		具体的数值。如某个按键在本年度被按下的次数。数值上限被限定为20亿次，超过的将被忽略。
```

```
day*_detail表，每日详细统计记录表。*号为具体的日期数字，如 day1_detail

表结构：
	_id MEDIUMINT PK
	year SMALLINT
	month TINYINT
	day TINIINT
	hour TINYINT
	minute TINYINT
	second TINYINT
	type SMALLINT
	value MEDIUMINT

表结构释义：
	year
	month
	day
	hour
	minute
	second
		具体日期。
	type
		统计类型，具体编号见下方定义。
	value
		具体事件的数值。
```

```
day*_summary表，每日数据统计表。

表结构：
	_id SMALLINT PK
	hour TINYINT
	type SMALLINT
	value MEDIUMINT
	
表结构释义：
	hour
		小时值，范围 0 ~ 23。
```




```
type类型值定义：

0 ~ 0xff 键盘按键值
0x110	!
0x111	@
0x112	#
0x113	$
0x114	%
0x115	^
0x116	&
0x117	*
0x118	(
0x119	)
0x11a	:
0x11b	+
0x11c	<
0x11d	_
0x11e	>
0x11f	?
0x120	~
0x121	{
0x122	|
0x123	}
0x124	"
0x170	左CTRL+SHIFT
0x171	右CTRL+SHIFT
0x172	左CTRL+右SHIFT
0x173	右CTRL+左SHIFT
0x174	左CTRL+ENTER
0x175	右CTRL+ENTER
0x176	左SHIFT+ENTER
0x177	右SHIFT+ENTER
0x178	左ALT+ENTER
0x179	右ALT+ENTER
0x17a	左ALT+TAB
0x17b	右ALT+TAB
0x17c	左CTRL+左SHIFT+ESC
0x17d	右CTRL+右SHIFT+ESC
0x17e	左SHIFT+HOME
0x17f	右SHIFT+HOME
0x180	左SHIFT+END
0x181	右SHIFT+END
0x182	左SHIFT+LEFT
0x183	右SHIFT+LEFT
0x184	左SHIFT+UP
0x185	右SHIFT+UP
0x186	左SHIFT+RIGHT
0x187	右SHIFT+RIGHT
0x188	左SHIFT+DOWN
0x189	右SHIFT+DOWN
0x18a	左CTRL+A
0x18b	右CTRL+A
0x18c	左CTRL+S
0x18d	右CTRL+S
0x18e	左CTRL+F
0x18f	右CTRL+F
0x190	左CTRL+C
0x191	右CTRL+C
0x192	左CTRL+V
0x193	右CTRL+V
0x1f0	其它双键组合键
0x1f1	其它三键组合键
0x1f2	其它四键组合键
0x200 ~ 0x20f	reserved
0x210	鼠标前侧键
0x211	鼠标后侧键
0x212	鼠标滚轮向前滚动格数
0x213	鼠标滚轮向后滚动格数
0x214	鼠标左键点击的屏幕区域号
0x215	鼠标右键点击的屏幕区域号
0x300	键盘总敲击量
0x301	键盘组合键敲击总量
0x302	鼠标按键点击总量
0x310	小时统计键盘敲击总量第一
0x311	小时统计键盘敲击总量第二
0x312	小时统计键盘敲击总量第三
0x313	小时统计键盘组合键总量第一
0x314	小时统计键盘组合键总量第二
0x315	小时统计键盘组合键总量第三
0x316	小时统计鼠标左键区域第一
0x317	小时统计鼠标左键区域第二
0x318	小时统计鼠标左键区域第三
0x319	小时统计鼠标右键区域第一
0x31a	小时统计鼠标右键区域第二
0x31b	小时统计鼠标右键区域第三
0x330	月度统计键盘敲击总量第一
0x331	月度统计键盘敲击总量第二
0x332	月度统计键盘敲击总量第三
0x333	月度统计键盘组合键总量第一
0x334	月度统计键盘组合键总量第二
0x335	月度统计键盘组合键总量第三
0x336	月度统计鼠标左键区域第一
0x337	月度统计鼠标左键区域第二
0x338	月度统计鼠标左键区域第三
0x339	月度统计鼠标右键区域第一
0x33a	月度统计鼠标右键区域第二
0x33b	月度统计鼠标右键区域第三
0x350	年度统计键盘敲击总量第一
0x351	年度统计键盘敲击总量第二
0x352	年度统计键盘敲击总量第三
0x353	年度统计键盘组合键总量第一
0x354	年度统计键盘组合键总量第二
0x355	年度统计键盘组合键总量第三
0x356	年度统计鼠标左键区域第一
0x357	年度统计鼠标左键区域第二
0x358	年度统计鼠标左键区域第三
0x359	年度统计鼠标右键区域第一
0x35a	年度统计鼠标右键区域第二
0x35b	年度统计鼠标右键区域第三
```

```
屏幕区域号：

将显示屏水平与垂直各等分为十块。因此整个屏幕将被划分为100个区域，这些区域按自左上角水平向右至右下角的顺序编号，此即为区域编号。范围值为 1 ~ 100。
```



年度数据统计：

根据实际需要手动/自动计算生成年度统计数据库。库文件名示例：kms2021.db





# B. UI

只用一个界面完成所有展示。

左上角展示总览信息，右上角展示所有按键数据的条形图。下方展示多样化统计信息，包括条形图，折线图。

通过Binding连接及更新数据。





# C. 程序逻辑

1. 日志模块

2. 时间管理模块

3. 数据库认证管理

   数据库与机器认证绑定或通过用户绑定。

4. 库表设计

5. 数据处理

6. 统计管理

7. 键鼠事件监听

   全局事件

   键盘：

     1、所有按键事件

   鼠标：

     1、鼠标移动的距离；

     2、左右按键的点击次数；

     3、滚轮的滚动格数；

     4、滚轮的点击次数。

8. 工具栏图标

9. ~~文件管理~~

10. 配置管理

    XML管理

